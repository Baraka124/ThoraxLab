{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm install",
    "watchPatterns": [
      "server.js",
      "database.js",
      "package.json"
    ]
  },
  "deploy": {
    "startCommand": "npm start",
    "healthcheckPath": "/api/health",
    "healthcheckTimeout": 60,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  },
  "env": {
    "PORT": {
      "description": "Port to run the server on",
      "value": "3000"
    },
    "NODE_ENV": {
      "description": "Node environment",
      "value": "production"
    },
    "DATABASE_PATH": {
      "description": "Path to SQLite database",
      "value": "/data/thoraxlab.db"
    },
    "SESSION_SECRET": {
      "description": "Secret for session encryption",
      "generator": "secret"
    },
    "JWT_SECRET": {
      "description": "Secret for JWT tokens",
      "generator": "secret"
    },
    "CORS_ORIGIN": {
      "description": "CORS allowed origins",
      "value": "*"
    },
    "RATE_LIMIT_WINDOW": {
      "description": "Rate limit window in minutes",
      "value": "15"
    },
    "RATE_LIMIT_MAX": {
      "description": "Max requests per window",
      "value": "100"
    },
    "WEB_SOCKET_TIMEOUT": {
      "description": "WebSocket connection timeout in seconds",
      "value": "300"
    }
  },
  "plugins": [
    {
      "name": "postgresql",
      "optional": true,
      "disabled": true,
      "env": {
        "DATABASE_URL": {
          "description": "PostgreSQL connection string"
        }
      }
    },
    {
      "name": "redis",
      "optional": true,
      "disabled": true,
      "env": {
        "REDIS_URL": {
          "description": "Redis connection string for sessions"
        }
      }
    }
  ],
  "static": {
    "publicDir": "public",
    "urlPrefix": "/"
  },
  "checks": {
    "readiness": {
      "type": "http",
      "port": 3000,
      "path": "/api/health",
      "interval": 30,
      "timeout": 5,
      "initialDelay": 10
    },
    "liveness": {
      "type": "http",
      "port": 3000,
      "path": "/api/health",
      "interval": 30,
      "timeout": 5
    }
  },
  "volumes": {
    "data": {
      "path": "/data",
      "size": "1GB"
    }
  }
}
