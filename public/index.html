<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThoraxLab | Innovation Collaboration Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* ==================== INNOVATION PLATFORM STYLES ==================== */
        :root {
            --innovation-blue: #0066CC;
            --innovation-blue-dark: #004D99;
            --innovation-blue-light: #E6F2FF;
            --innovation-green: #00A86B;
            --innovation-purple: #8A2BE2;
            --innovation-orange: #FF9800;
            --innovation-red: #E53935;
            
            --clinician-color: #2196F3;
            --industry-color: #FF9800;
            --researcher-color: #9C27B0;
            --investor-color: #4CAF50;
            --patient-color: #009688;
            
            --text-dark: #1A202C;
            --text-medium: #4A5568;
            --text-light: #718096;
            --background-gray: #F7FAFC;
            --card-white: #FFFFFF;
            --border-subtle: #E2E8F0;
            
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background-gray);
            color: var(--text-dark);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-lg);
        }

        /* ==================== HEADER ==================== */
        .header {
            background: linear-gradient(135deg, var(--innovation-blue), var(--innovation-blue-dark));
            color: white;
            padding: var(--space-md) 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-lg);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            text-decoration: none;
        }

        .logo-symbol {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--innovation-blue);
            font-weight: 800;
            font-size: 1.25rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .quick-actions {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.9375rem;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            font-family: inherit;
        }

        .btn-primary {
            background: white;
            color: var(--innovation-blue);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ==================== HERO ==================== */
        .hero {
            padding: var(--space-2xl) 0;
            background: linear-gradient(135deg, 
                rgba(0, 102, 204, 0.05) 0%,
                rgba(0, 168, 107, 0.08) 100%);
            border-bottom: 1px solid var(--border-subtle);
        }

        .hero-content {
            max-width: 800px;
            text-align: center;
            margin: 0 auto;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: var(--space-lg);
            background: linear-gradient(135deg, var(--innovation-blue), var(--innovation-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-medium);
            line-height: 1.5;
            margin-bottom: var(--space-xl);
        }

        /* ==================== PROJECTS GRID ==================== */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-xl) 0;
        }

        .project-card {
            background: var(--card-white);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            border: 1px solid var(--border-subtle);
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 102, 204, 0.1);
            border-color: var(--innovation-blue);
        }

        .project-stage {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
            align-self: flex-start;
        }

        .stage-ideation { background: rgba(0, 102, 204, 0.1); color: var(--innovation-blue); }
        .stage-development { background: rgba(255, 152, 0, 0.1); color: var(--innovation-orange); }
        .stage-validation { background: rgba(156, 39, 176, 0.1); color: var(--innovation-purple); }
        .stage-scale { background: rgba(0, 168, 107, 0.1); color: var(--innovation-green); }

        .project-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: var(--space-sm);
            line-height: 1.3;
        }

        .project-description {
            color: var(--text-medium);
            font-size: 0.9375rem;
            line-height: 1.5;
            margin-bottom: var(--space-lg);
            flex: 1;
        }

        .project-problem {
            font-size: 0.875rem;
            color: var(--text-light);
            background: var(--background-gray);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
            border-left: 3px solid var(--innovation-red);
        }

        .project-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border-subtle);
        }

        .stakeholder-avatars {
            display: flex;
            align-items: center;
        }

        .stakeholder-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            margin-right: -8px;
            border: 2px solid white;
        }

        .stakeholder-count {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-left: var(--space-md);
        }

        .project-stats {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: 0.875rem;
            color: var(--text-light);
        }

        /* ==================== MODALS ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--space-lg);
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--card-white);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
            padding: var(--space-xs);
            border-radius: var(--radius-sm);
        }

        .modal-body {
            padding: var(--space-xl);
        }

        .modal-footer {
            padding: var(--space-xl);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            gap: var(--space-md);
            justify-content: flex-end;
        }

        /* ==================== FORMS ==================== */
        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9375rem;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.875rem var(--space-md);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 0.9375rem;
            transition: all 0.2s;
            background: var(--card-white);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--innovation-blue);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .stakeholder-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .stakeholder-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            background: var(--background-gray);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .stakeholder-option:hover {
            border-color: var(--innovation-blue);
            background: white;
        }

        .stakeholder-option.selected {
            border-color: var(--innovation-blue);
            background: rgba(0, 102, 204, 0.05);
        }

        /* ==================== NOTIFICATIONS ==================== */
        .notification-container {
            position: fixed;
            top: var(--space-lg);
            right: var(--space-lg);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            max-width: 400px;
        }

        .notification {
            background: var(--card-white);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            border-left: 4px solid var(--innovation-blue);
            animation: slideIn 0.3s ease;
            transform: translateX(100%);
            opacity: 0;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--space-md);
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .projects-grid {
                grid-template-columns: 1fr;
            }
            
            .stakeholder-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header-content {
                flex-direction: column;
                gap: var(--space-md);
            }
        }

        @media (max-width: 480px) {
            .stakeholder-options {
                grid-template-columns: 1fr;
            }
            
            .hero-title {
                font-size: 1.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-symbol">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="logo-text">ThoraxLab</div>
                </div>
                
                <div class="quick-actions">
                    <button class="btn btn-secondary" id="joinPlatformBtn">
                        <i class="fas fa-user-plus"></i> Join Platform
                    </button>
                    <button class="btn btn-primary" id="newProjectBtn">
                        <i class="fas fa-plus"></i> New Innovation
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">Healthcare Innovation Collaboration</h1>
                <p class="hero-subtitle">
                    A shared space for clinicians, industry partners, researchers, investors, 
                    and patients to collaborate on transformative healthcare innovations.
                </p>
                <div style="display: flex; gap: var(--space-md); justify-content: center;">
                    <button class="btn btn-primary" id="exploreProjectsBtn">
                        <i class="fas fa-search"></i> Explore Innovations
                    </button>
                    <button class="btn btn-secondary" id="howItWorksBtn">
                        <i class="fas fa-play-circle"></i> How It Works
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin: var(--space-xl) 0;">
            <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--text-dark);">
                <i class="fas fa-rocket" style="color: var(--innovation-blue);"></i>
                Active Innovation Projects
            </h2>
            <div style="display: flex; gap: var(--space-sm);">
                <select id="stageFilter" class="form-input" style="width: 150px;">
                    <option value="">All Stages</option>
                    <option value="ideation">Ideation</option>
                    <option value="development">Development</option>
                    <option value="validation">Validation</option>
                    <option value="scale">Scale</option>
                </select>
                <button class="btn btn-secondary" id="refreshProjectsBtn">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>

        <!-- Projects Grid -->
        <div id="projectsContainer" class="projects-grid">
            <!-- Projects loaded dynamically -->
            <div style="grid-column: 1 / -1; text-align: center; padding: var(--space-2xl); color: var(--text-light);">
                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: var(--space-md);"></i>
                <p>Loading innovation projects...</p>
            </div>
        </div>

        <!-- Activity Feed -->
        <div style="margin: var(--space-2xl) 0;">
            <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--text-dark); margin-bottom: var(--space-lg);">
                <i class="fas fa-bolt" style="color: var(--innovation-orange);"></i>
                Recent Activity
            </h2>
            <div id="activityContainer" style="background: var(--card-white); border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); padding: var(--space-lg);">
                <div style="text-align: center; padding: var(--space-xl); color: var(--text-light);">
                    <i class="fas fa-spinner fa-spin" style="margin-right: var(--space-sm);"></i>
                    Loading recent activity...
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Join Platform Modal -->
    <div id="joinModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Join Innovation Platform</h2>
                <button class="modal-close" id="closeJoinModal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-medium); margin-bottom: var(--space-lg);">
                    Select your role to start collaborating. No account needed - just start contributing!
                </p>
                
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" 
                           id="userName" 
                           class="form-input" 
                           placeholder="Enter your name (optional)">
                </div>
                
                <div class="form-group">
                    <label class="form-label">I am a:</label>
                    <div class="stakeholder-options">
                        <div class="stakeholder-option" data-type="clinician">
                            <div style="width: 48px; height: 48px; background: rgba(33, 150, 243, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--clinician-color); font-size: 1.25rem;">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <span style="font-weight: 600; font-size: 0.875rem;">Clinician</span>
                        </div>
                        <div class="stakeholder-option" data-type="industry">
                            <div style="width: 48px; height: 48px; background: rgba(255, 152, 0, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--industry-color); font-size: 1.25rem;">
                                <i class="fas fa-industry"></i>
                            </div>
                            <span style="font-weight: 600; font-size: 0.875rem;">Industry</span>
                        </div>
                        <div class="stakeholder-option" data-type="researcher">
                            <div style="width: 48px; height: 48px; background: rgba(156, 39, 176, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--researcher-color); font-size: 1.25rem;">
                                <i class="fas fa-flask"></i>
                            </div>
                            <span style="font-weight: 600; font-size: 0.875rem;">Researcher</span>
                        </div>
                        <div class="stakeholder-option" data-type="investor">
                            <div style="width: 48px; height: 48px; background: rgba(76, 175, 80, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--investor-color); font-size: 1.25rem;">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <span style="font-weight: 600; font-size: 0.875rem;">Investor</span>
                        </div>
                        <div class="stakeholder-option" data-type="patient">
                            <div style="width: 48px; height: 48px; background: rgba(0, 150, 136, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--patient-color); font-size: 1.25rem;">
                                <i class="fas fa-user"></i>
                            </div>
                            <span style="font-weight: 600; font-size: 0.875rem;">Patient</span>
                        </div>
                        <div class="stakeholder-option" data-type="other">
                            <div style="width: 48px; height: 48px; background: rgba(0, 102, 204, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--innovation-blue); font-size: 1.25rem;">
                                <i class="fas fa-users"></i>
                            </div>
                            <span style="font-weight: 600; font-size: 0.875rem;">Other</span>
                        </div>
                    </div>
                    <input type="hidden" id="selectedRole" value="">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Organization (optional)</label>
                    <input type="text" 
                           id="userOrganization" 
                           class="form-input" 
                           placeholder="Hospital, company, institution">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelJoin">Cancel</button>
                <button class="btn btn-primary" id="confirmJoin">
                    <i class="fas fa-rocket"></i> Start Collaborating
                </button>
            </div>
        </div>
    </div>

    <!-- New Project Modal -->
    <div id="newProjectModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Start New Innovation</h2>
                <button class="modal-close" id="closeProjectModal">&times;</button>
            </div>
            <form id="createProjectForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Innovation Title *</label>
                        <input type="text" 
                               id="projectTitle" 
                               class="form-input" 
                               required
                               placeholder="e.g., AI-Powered Diagnostic Tool for Early Detection">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">What problem does this solve? *</label>
                        <textarea id="projectProblem" 
                                  class="form-textarea" 
                                  required
                                  placeholder="Describe the clinical or healthcare problem..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Innovation Description *</label>
                        <textarea id="projectDescription" 
                                  class="form-textarea" 
                                  required
                                  placeholder="Describe your innovation idea or solution..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Current Stage</label>
                        <select id="projectStage" class="form-input">
                            <option value="ideation">Ideation - Early concept</option>
                            <option value="development">Development - Building prototype</option>
                            <option value="validation">Validation - Testing & feedback</option>
                            <option value="scale">Scale - Ready for implementation</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tags (comma separated)</label>
                        <input type="text" 
                               id="projectTags" 
                               class="form-input" 
                               placeholder="e.g., AI, diagnostics, remote monitoring, surgical tools">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelProject">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create Innovation Project
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <script>
        class InnovationPlatform {
            constructor() {
                this.API_BASE = window.location.origin;
                this.currentUser = null;
                this.socket = null;
                this.projects = [];
                this.activity = [];
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadProjects();
                this.loadActivity();
                this.initSocket();
            }

            setupEventListeners() {
                // Header buttons
                document.getElementById('joinPlatformBtn')?.addEventListener('click', () => this.showModal('join'));
                document.getElementById('newProjectBtn')?.addEventListener('click', () => this.showModal('project'));
                document.getElementById('exploreProjectsBtn')?.addEventListener('click', () => this.loadProjects());
                document.getElementById('refreshProjectsBtn')?.addEventListener('click', () => this.loadProjects());
                
                // Join modal
                document.getElementById('closeJoinModal')?.addEventListener('click', () => this.hideModal());
                document.getElementById('cancelJoin')?.addEventListener('click', () => this.hideModal());
                document.getElementById('confirmJoin')?.addEventListener('click', () => this.joinPlatform());
                
                // Project modal
                document.getElementById('closeProjectModal')?.addEventListener('click', () => this.hideModal());
                document.getElementById('cancelProject')?.addEventListener('click', () => this.hideModal());
                document.getElementById('createProjectForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createProject();
                });
                
                // Stakeholder selection
                document.querySelectorAll('.stakeholder-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('.stakeholder-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        option.classList.add('selected');
                        document.getElementById('selectedRole').value = option.dataset.type;
                    });
                });
                
                // Set default selection
                document.querySelector('.stakeholder-option[data-type="clinician"]')?.click();
                
                // Modal backdrop click
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal-overlay')) {
                        this.hideModal();
                    }
                });
                
                // Escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideModal();
                    }
                });
            }

            async loadProjects() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/projects`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.projects = data.data;
                        this.renderProjects();
                    }
                } catch (error) {
                    console.error('Failed to load projects:', error);
                    this.showNotification('Error', 'Failed to load innovation projects', 'error');
                }
            }

            renderProjects() {
                const container = document.getElementById('projectsContainer');
                if (!container) return;
                
                if (this.projects.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: var(--space-2xl);">
                            <i class="fas fa-lightbulb" style="font-size: 3rem; color: var(--text-light); margin-bottom: var(--space-md);"></i>
                            <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--text-dark); margin-bottom: var(--space-sm);">
                                No Innovation Projects Yet
                            </h3>
                            <p style="color: var(--text-medium); margin-bottom: var(--space-lg);">
                                Be the first to start an innovation project!
                            </p>
                            <button class="btn btn-primary" id="createFirstProject">
                                <i class="fas fa-plus"></i> Start First Project
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('createFirstProject')?.addEventListener('click', () => {
                        this.showModal('project');
                    });
                    return;
                }
                
                container.innerHTML = this.projects.map(project => {
                    const stageClass = `stage-${project.stage || 'ideation'}`;
                    const stageLabel = project.stage ? 
                        project.stage.charAt(0).toUpperCase() + project.stage.slice(1) : 
                        'Ideation';
                    
                    // Get unique stakeholder types
                    const stakeholderTypes = [...new Set(project.stakeholders.map(s => s.type))];
                    
                    return `
                        <div class="project-card" data-project-id="${project.id}" onclick="window.innovationPlatform.openProject('${project.id}')">
                            <div class="project-stage ${stageClass}">
                                <i class="fas fa-${this.getStageIcon(project.stage)}"></i>
                                ${stageLabel}
                            </div>
                            
                            <h3 class="project-title">${this.escapeHtml(project.title)}</h3>
                            
                            <div class="project-problem">
                                <strong>Problem:</strong> ${this.escapeHtml(project.problem.substring(0, 150))}${project.problem.length > 150 ? '...' : ''}
                            </div>
                            
                            <p class="project-description">${this.escapeHtml(project.description.substring(0, 120))}${project.description.length > 120 ? '...' : ''}</p>
                            
                            <div class="project-meta">
                                <div>
                                    <div class="stakeholder-avatars">
                                        ${stakeholderTypes.slice(0, 3).map(type => `
                                            <div class="stakeholder-avatar" style="background: ${this.getStakeholderColor(type)};">
                                                ${this.getStakeholderIcon(type)}
                                            </div>
                                        `).join('')}
                                        ${stakeholderTypes.length > 3 ? `
                                            <div class="stakeholder-avatar" style="background: var(--text-light);">
                                                +${stakeholderTypes.length - 3}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div class="stakeholder-count">${project.stakeholders.length} collaborators</div>
                                </div>
                                
                                <div class="project-stats">
                                    <span><i class="fas fa-comment"></i> ${project.metrics?.comments || 0}</span>
                                    <span><i class="fas fa-comments"></i> ${project.metrics?.discussions || 0}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            async loadActivity() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/activity?limit=10`);
                    
                    if (!response.ok) return;
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.activity = data.data;
                        this.renderActivity();
                    }
                } catch (error) {
                    console.error('Failed to load activity:', error);
                }
            }

            renderActivity() {
                const container = document.getElementById('activityContainer');
                if (!container || !this.activity.length) return;
                
                container.innerHTML = this.activity.map(item => {
                    let icon = 'fa-bell';
                    let color = 'var(--innovation-blue)';
                    let text = '';
                    
                    switch (item.type) {
                        case 'project_created':
                            icon = 'fa-plus-circle';
                            color = 'var(--innovation-green)';
                            text = `<strong>${this.escapeHtml(item.author?.name || 'Someone')}</strong> created innovation project <strong>"${this.escapeHtml(item.title)}"</strong>`;
                            break;
                        case 'discussion_created':
                            icon = 'fa-comment-medical';
                            color = 'var(--innovation-purple)';
                            text = `<strong>${this.escapeHtml(item.author?.name || 'Someone')}</strong> started discussion <strong>"${this.escapeHtml(item.title)}"</strong>`;
                            break;
                        case 'comment_added':
                            icon = 'fa-comment';
                            color = 'var(--innovation-orange)';
                            text = `<strong>${this.escapeHtml(item.author?.name || 'Someone')}</strong> added a comment`;
                            break;
                    }
                    
                    const timeAgo = this.formatTimeAgo(item.timestamp);
                    
                    return `
                        <div style="display: flex; align-items: flex-start; gap: var(--space-md); padding: var(--space-sm) 0; border-bottom: 1px solid var(--border-subtle);">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: ${color}; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.875rem;">
                                <i class="fas ${icon}"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 0.9375rem; color: var(--text-medium);">
                                    ${text}
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 2px;">
                                    ${timeAgo}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            async joinPlatform() {
                const name = document.getElementById('userName').value.trim();
                const role = document.getElementById('selectedRole').value;
                const organization = document.getElementById('userOrganization').value.trim();
                
                if (!role) {
                    this.showNotification('Select Role', 'Please select your stakeholder role', 'warning');
                    return;
                }
                
                try {
                    const response = await fetch(`${this.API_BASE}/api/quick-join`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: name || undefined,
                            type: role,
                            role: this.getRoleTitle(role),
                            organization: organization || undefined
                        })
                    });
                    
                    if (!response.ok) throw new Error('Join failed');
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.currentUser = data.data;
                        this.hideModal();
                        this.showNotification('Welcome!', `Welcome to ThoraxLab as a ${this.getRoleTitle(role)}`, 'success');
                        
                        // Update UI to show user is joined
                        document.getElementById('joinPlatformBtn').innerHTML = `
                            <i class="fas fa-user-check"></i> ${this.currentUser.name}
                        `;
                    }
                } catch (error) {
                    console.error('Join error:', error);
                    this.showNotification('Error', 'Failed to join platform', 'error');
                }
            }

            async createProject() {
                if (!this.currentUser) {
                    this.showNotification('Join First', 'Please join the platform first to create projects', 'warning');
                    this.showModal('join');
                    return;
                }
                
                const title = document.getElementById('projectTitle').value.trim();
                const problem = document.getElementById('projectProblem').value.trim();
                const description = document.getElementById('projectDescription').value.trim();
                const stage = document.getElementById('projectStage').value;
                const tags = document.getElementById('projectTags').value.split(',').map(t => t.trim()).filter(t => t);
                
                if (!title || !problem || !description) {
                    this.showNotification('Missing Fields', 'Please fill in all required fields', 'warning');
                    return;
                }
                
                try {
                    const response = await fetch(`${this.API_BASE}/api/projects`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            title,
                            problem,
                            description,
                            stage,
                            tags,
                            stakeholder: this.currentUser
                        })
                    });
                    
                    if (!response.ok) throw new Error('Create project failed');
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.hideModal();
                        this.showNotification('Success!', 'Innovation project created', 'success');
                        this.loadProjects();
                        this.loadActivity();
                        
                        // Reset form
                        document.getElementById('createProjectForm').reset();
                    }
                } catch (error) {
                    console.error('Create project error:', error);
                    this.showNotification('Error', 'Failed to create project', 'error');
                }
            }

            openProject(projectId) {
                window.location.href = `/project.html?id=${projectId}`;
            }

            showModal(modalType) {
                const modal = document.getElementById(`${modalType}Modal`);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            hideModal() {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('active');
                });
                document.body.style.overflow = '';
            }

            showNotification(title, message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                if (!container) return;
                
                const notification = document.createElement('div');
                notification.className = `notification`;
                notification.innerHTML = `
                    <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 4px;">${this.escapeHtml(title)}</div>
                    <div style="font-size: 0.9375rem; color: var(--text-medium);">${this.escapeHtml(message)}</div>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => notification.classList.add('show'), 10);
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }

            initSocket() {
                this.socket = io(this.API_BASE);
                
                this.socket.on('connect', () => {
                    console.log('üîå Connected to real-time server');
                });
                
                this.socket.on('project:updated', (data) => {
                    console.log('Project updated:', data);
                    this.loadProjects();
                    this.loadActivity();
                });
                
                this.socket.on('discussion:created', (discussion) => {
                    this.showNotification('New Discussion', `"${discussion.title}" started`, 'info');
                    this.loadActivity();
                });
            }

            // Utility methods
            getStageIcon(stage) {
                const icons = {
                    'ideation': 'lightbulb',
                    'development': 'tools',
                    'validation': 'check-circle',
                    'scale': 'rocket'
                };
                return icons[stage] || 'lightbulb';
            }

            getStakeholderColor(type) {
                const colors = {
                    'clinician': '#2196F3',
                    'industry': '#FF9800',
                    'researcher': '#9C27B0',
                    'investor': '#4CAF50',
                    'patient': '#009688',
                    'other': '#0066CC'
                };
                return colors[type] || '#718096';
            }

            getStakeholderIcon(type) {
                const icons = {
                    'clinician': 'üë®‚Äç‚öïÔ∏è',
                    'industry': 'üè≠',
                    'researcher': 'üî¨',
                    'investor': 'üìà',
                    'patient': 'üë§',
                    'other': 'üë•'
                };
                return icons[type] || 'üë§';
            }

            getRoleTitle(role) {
                const titles = {
                    'clinician': 'Clinician',
                    'industry': 'Industry Partner',
                    'researcher': 'Researcher',
                    'investor': 'Investor',
                    'patient': 'Patient',
                    'other': 'Collaborator'
                };
                return titles[role] || 'Collaborator';
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            formatTimeAgo(timestamp) {
                try {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    if (diffMins < 60) return `${diffMins}m ago`;
                    if (diffHours < 24) return `${diffHours}h ago`;
                    if (diffDays < 7) return `${diffDays}d ago`;
                    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                } catch {
                    return 'Recently';
                }
            }
        }

        // Initialize platform
        window.addEventListener('DOMContentLoaded', () => {
            window.innovationPlatform = new InnovationPlatform();
        });
    </script>
</body>
</html>
