<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[TH√òRAX][LAB] | Project</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=SF+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --thorax-primary: #1A5F7A;
            --thorax-secondary: #0D8B70;
            --thorax-accent: #6D5ACF;
            --ui-dark: #1E293B;
            --ui-light: #64748B;
            --ui-bg: #F8FAFC;
            --ui-card: #FFFFFF;
            --ui-border: #E2E8F0;
            --radius-md: 10px;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --ui-disabled: #F1F5F9;
            --ui-text-disabled: #94A3B8;
            --ui-success: #10B981;
            --ui-warning: #F59E0B;
            --ui-error: #EF4444;
            --ui-info: #3B82F6;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--ui-bg); 
            color: var(--ui-dark);
            min-height: 100vh;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; }
        
        /* Header */
        .app-header {
            background: var(--ui-card);
            border-bottom: 1px solid var(--ui-border);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
        }
        
        .nav-brand {
            font-family: 'SF Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--ui-dark);
            text-decoration: none;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 9999px;
            background: var(--ui-bg);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .user-profile:hover { background: var(--ui-border); }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--thorax-primary), var(--thorax-accent));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .user-name { font-weight: 600; font-size: 0.875rem; }
        .user-role { font-size: 0.75rem; color: var(--ui-light); }
        
        /* Buttons */
        .btn {
            padding: 0.875rem 1.5rem;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--thorax-primary);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #14485E;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: white;
            color: var(--ui-dark);
            border: 1px solid var(--ui-border);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--ui-bg);
            border-color: var(--thorax-primary);
        }
        
        .btn-disabled {
            background: var(--ui-disabled);
            color: var(--ui-text-disabled);
            cursor: not-allowed;
            border: 1px solid var(--ui-border);
        }
        
        .btn-disabled:hover {
            transform: none;
            box-shadow: none;
            background: var(--ui-disabled);
        }
        
        /* Project container */
        .project-container {
            padding: 2rem 0;
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--thorax-primary);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 2rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }
        
        .back-button:hover {
            background: rgba(26, 95, 122, 0.1);
        }
        
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        
        .project-title-section {
            flex: 1;
            min-width: 300px;
        }
        
        .project-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--ui-dark);
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }
        
        .project-meta {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            color: var(--ui-light);
            font-size: 0.875rem;
            flex-wrap: wrap;
        }
        
        .project-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: #10B981;
        }
        
        .status-demo {
            background: rgba(245, 158, 11, 0.1);
            color: var(--ui-warning);
        }
        
        .project-actions {
            display: flex;
            gap: 1rem;
        }
        
        /* Two-column layout */
        .project-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }
        
        @media (max-width: 1024px) {
            .project-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .project-main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .project-sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        /* Project sections */
        .project-section {
            background: var(--ui-card);
            border-radius: 14px;
            padding: 1.75rem;
            border: 1px solid var(--ui-border);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--ui-dark);
        }
        
        .project-description {
            color: var(--ui-dark);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }
        
        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--ui-light);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }
        
        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--ui-dark);
            margin-bottom: 0.5rem;
        }
        
        .empty-state-description {
            max-width: 500px;
            margin: 0 auto 1.5rem;
            line-height: 1.6;
        }
        
        /* Implementation Guide */
        .implementation-guide {
            background: var(--ui-bg);
            border: 1px solid var(--ui-border);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .guide-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--ui-dark);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .guide-step {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--ui-border);
        }
        
        .guide-step:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .step-number {
            width: 24px;
            height: 24px;
            background: var(--thorax-primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: var(--ui-dark);
        }
        
        .step-description {
            font-size: 0.875rem;
            color: var(--ui-light);
            line-height: 1.5;
        }
        
        /* Team section */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .team-member {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--ui-border);
            transition: all 0.2s;
        }
        
        .team-member.empty {
            background: var(--ui-bg);
            border-style: dashed;
            color: var(--ui-light);
            justify-content: center;
            min-height: 80px;
        }
        
        .member-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--thorax-primary), var(--thorax-accent));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .member-info {
            flex: 1;
        }
        
        .member-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .member-role {
            font-size: 0.875rem;
            color: var(--ui-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .role-badge {
            padding: 0.125rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .role-clinician {
            background: rgba(26, 95, 122, 0.1);
            color: var(--thorax-primary);
        }
        
        .role-industry {
            background: rgba(109, 90, 207, 0.1);
            color: var(--thorax-accent);
        }
        
        /* Timeline - Empty */
        .timeline {
            position: relative;
            padding-left: 2rem;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 9px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--ui-border);
        }
        
        .timeline-empty {
            position: relative;
            padding-left: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .timeline-dot {
            position: absolute;
            left: -2rem;
            top: 0;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--ui-border);
            border: 3px solid var(--ui-card);
        }
        
        .timeline-content {
            padding: 0.75rem;
            background: var(--ui-bg);
            border-radius: var(--radius-md);
            border: 1px solid var(--ui-border);
            color: var(--ui-light);
        }
        
        /* Engagement Preview */
        .engagement-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            text-align: center;
            padding: 1rem;
            background: var(--ui-bg);
            border-radius: var(--radius-md);
            border: 1px solid var(--ui-border);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--thorax-primary);
            margin-bottom: 0.25rem;
        }
        
        .stat-value.empty {
            color: var(--ui-text-disabled);
            font-size: 1.25rem;
            font-weight: 400;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--ui-light);
        }
        
        /* Toast */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }
        
        .toast {
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            animation: toastSlideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--thorax-primary);
            color: white;
        }
        
        .toast-info { background: var(--ui-info); }
        .toast-success { background: var(--ui-success); }
        .toast-warning { background: var(--ui-warning); }
        .toast-error { background: var(--ui-error); }
        
        @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loading states */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--ui-light);
            grid-column: 1 / -1;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--ui-border);
            border-top-color: var(--thorax-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error state */
        .error-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--ui-light);
        }
        
        .error-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal-content {
            background: var(--ui-card);
            border-radius: 18px;
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--ui-dark);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--ui-light);
            padding: 0.5rem;
            line-height: 1;
        }
        
        /* Form styles */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--ui-dark);
            font-size: 0.875rem;
        }
        
        .form-input, .form-select, .form-textarea {
            padding: 0.875rem 1rem;
            border: 2px solid var(--ui-border);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 1rem;
            background: var(--ui-card);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--thorax-primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .hidden { display: none !important; }
        
        /* Tab navigation */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--ui-border);
            margin-bottom: 2rem;
        }
        
        .tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            color: var(--ui-light);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
        }
        
        .tab:hover {
            color: var(--thorax-primary);
        }
        
        .tab.active {
            color: var(--thorax-primary);
            border-bottom-color: var(--thorax-primary);
        }
        
        .tab-status {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Feature Status */
        .feature-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-implemented {
            background: rgba(16, 185, 129, 0.1);
            color: var(--ui-success);
        }
        
        .status-backend-required {
            background: rgba(239, 68, 68, 0.1);
            color: var(--ui-error);
        }
        
        .status-partial {
            background: rgba(245, 158, 11, 0.1);
            color: var(--ui-warning);
        }
        
        .status-disabled {
            background: rgba(148, 163, 184, 0.1);
            color: var(--ui-text-disabled);
        }
        
        /* Backend Status */
        .backend-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--ui-bg);
            border: 1px solid var(--ui-border);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-connected { background: var(--ui-success); }
        .status-disconnected { background: var(--ui-error); }
        .status-pending { background: var(--ui-warning); }
        
        /* API Documentation */
        .api-docs {
            background: #1E293B;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-top: 1rem;
            overflow-x: auto;
        }
        
        .code {
            font-family: 'SF Mono', monospace;
            font-size: 0.875rem;
            color: #E2E8F0;
            line-height: 1.5;
        }
        
        .code-comment { color: #64748B; }
        .code-keyword { color: #F472B6; }
        .code-string { color: #34D399; }
        .code-number { color: #60A5FA; }
        .code-function { color: #FBBF24; }
        
        /* Thread Preview */
        .thread-preview {
            padding: 1rem;
            border: 1px solid var(--ui-border);
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .thread-preview:hover:not(.empty) {
            border-color: var(--thorax-primary);
            transform: translateX(2px);
        }
        
        .thread-preview.empty {
            background: var(--ui-bg);
            border-style: dashed;
            cursor: default;
            text-align: center;
            color: var(--ui-light);
        }
        
        .thread-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        
        .thread-title {
            font-weight: 600;
            color: var(--ui-dark);
            flex: 1;
        }
        
        .thread-meta {
            font-size: 0.875rem;
            color: var(--ui-light);
        }
        
        .thread-excerpt {
            color: var(--ui-light);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .thread-engagement {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--ui-light);
        }
        
        .engagement-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        /* Warning Banner */
        .warning-banner {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .warning-icon {
            color: var(--ui-warning);
            flex-shrink: 0;
            margin-top: 0.25rem;
        }
        
        .warning-content {
            flex: 1;
        }
        
        .warning-title {
            font-weight: 600;
            color: var(--ui-warning);
            margin-bottom: 0.25rem;
        }
        
        .warning-description {
            font-size: 0.875rem;
            color: var(--ui-light);
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- Toast container -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="nav-brand">[TH√òRAX][LAB]</a>
                
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="backend-status">
                        <div class="status-indicator status-disconnected"></div>
                        <span>Demo Mode Active</span>
                    </div>
                    
                    <a href="index.html" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </a>
                    
                    <div id="userProfile" class="user-profile">
                        <div id="userAvatar" class="user-avatar">?</div>
                        <div class="user-info">
                            <div id="userDisplayName" class="user-name">Demo User</div>
                            <div id="userDisplayRole" class="user-role">Frontend Preview</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main project content -->
    <main class="project-container">
        <div class="container">
            <!-- Loading state -->
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>Loading project details...</p>
            </div>
            
            <!-- Error state -->
            <div id="errorState" class="error-state hidden">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h3 style="color: var(--ui-dark); margin-bottom: 0.5rem;">Project Not Found</h3>
                <p style="margin-bottom: 1.5rem;">This project doesn't exist or you don't have access.</p>
                <a href="index.html" class="btn btn-primary">
                    <i class="fas fa-home"></i>
                    Return to Dashboard
                </a>
            </div>
            
            <!-- Project content (hidden until loaded) -->
            <div id="projectContent" class="hidden">
                <!-- Warning banner -->
                <div class="warning-banner">
                    <div class="warning-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="warning-content">
                        <div class="warning-title">Frontend Preview Mode</div>
                        <div class="warning-description">
                            This project view is running in demo mode. All data is stored locally and will be lost on page refresh. 
                            To enable persistent projects, discussions, and team collaboration, implement the backend API endpoints.
                        </div>
                    </div>
                </div>
                
                <!-- Back navigation -->
                <a href="index.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to All Projects
                </a>
                
                <!-- Project header -->
                <div class="project-header">
                    <div class="project-title-section">
                        <h1 id="projectTitle" class="project-title">Project Title</h1>
                        <div class="project-meta">
                            <span id="projectType">Demo Project</span>
                            <span>‚Ä¢</span>
                            <span id="projectCreated">Created just now</span>
                            <span>‚Ä¢</span>
                            <span id="projectStatus" class="project-status status-demo">
                                <i class="fas fa-flask"></i>
                                Demo Mode
                            </span>
                        </div>
                    </div>
                    
                    <div class="project-actions">
                        <button id="editProjectBtn" class="btn btn-disabled" title="Requires backend implementation">
                            <i class="fas fa-edit"></i>
                            Edit (Disabled)
                        </button>
                        <button id="newThreadBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Start Discussion (Demo)
                        </button>
                    </div>
                </div>
                
                <!-- Two-column layout -->
                <div class="project-layout">
                    <!-- Main content -->
                    <div class="project-main">
                        <!-- Tab navigation -->
                        <div class="tabs">
                            <button class="tab active" data-tab="overview">
                                Overview
                                <div class="tab-status status-partial"></div>
                            </button>
                            <button class="tab" data-tab="discussions">
                                Discussions
                                <div class="tab-status status-backend-required"></div>
                            </button>
                            <button class="tab" data-tab="documents">
                                Documents
                                <div class="tab-status status-backend-required"></div>
                            </button>
                            <button class="tab" data-tab="timeline">
                                Timeline
                                <div class="tab-status status-backend-required"></div>
                            </button>
                        </div>
                        
                        <!-- Overview tab -->
                        <div id="overviewTab" class="tab-content active">
                            <div class="project-section">
                                <div class="section-header">
                                    <h2 class="section-title">Project Description</h2>
                                </div>
                                <div id="projectDescription" class="project-description">
                                    <p>This project description will appear here once you create or load a project.</p>
                                    <p><strong>Demo Note:</strong> In a full implementation, this would include detailed project goals, clinical objectives, technical requirements, and collaboration guidelines.</p>
                                </div>
                            </div>
                            
                            <!-- Recent activity preview -->
                            <div class="project-section">
                                <div class="section-header">
                                    <h2 class="section-title">Recent Activity</h2>
                                    <div class="feature-status status-backend-required">Backend Required</div>
                                </div>
                                
                                <div id="recentActivity" class="empty-state" style="padding: 2rem; text-align: left;">
                                    <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3; text-align: center;">üí¨</div>
                                    <h3 style="color: var(--ui-dark); margin-bottom: 0.5rem;">No Activity Yet</h3>
                                    <p style="color: var(--ui-light); margin-bottom: 1.5rem;">
                                        Activity feed will show recent discussions, comments, and updates when the backend is implemented.
                                    </p>
                                    
                                    <div class="implementation-guide">
                                        <div class="guide-title">To Enable Activity Feed</div>
                                        <div class="guide-step">
                                            <div class="step-number">1</div>
                                            <div class="step-content">
                                                <div class="step-title">Implement Discussion System</div>
                                                <div class="step-description">Create thread and comment database models with real-time updates</div>
                                            </div>
                                        </div>
                                        <div class="guide-step">
                                            <div class="step-number">2</div>
                                            <div class="step-content">
                                                <div class="step-title">Add WebSocket Events</div>
                                                <div class="step-description">Send real-time notifications for new discussions and comments</div>
                                            </div>
                                        </div>
                                        <div class="guide-step">
                                            <div class="step-number">3</div>
                                            <div class="step-content">
                                                <div class="step-title">Create Activity Endpoint</div>
                                                <div class="step-description">GET /api/projects/:id/activity to fetch recent activity</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Discussions tab -->
                        <div id="discussionsTab" class="tab-content">
                            <div class="project-section">
                                <div class="section-header">
                                    <h2 class="section-title">Discussion Threads</h2>
                                    <button id="startDiscussionBtn" class="btn btn-primary">
                                        <i class="fas fa-plus"></i>
                                        New Thread (Demo)
                                    </button>
                                </div>
                                
                                <div class="warning-banner" style="margin-bottom: 2rem;">
                                    <div class="warning-icon">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="warning-content">
                                        <div class="warning-title">Discussion System Not Implemented</div>
                                        <div class="warning-description">
                                            Threads and comments require backend implementation. Demo threads are stored locally only.
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="discussionsList" class="empty-state" style="padding: 2rem;">
                                    <div class="empty-state-icon">üí¨</div>
                                    <h3 class="empty-state-title">No Discussions Yet</h3>
                                    <p class="empty-state-description">
                                        Start the first discussion to collaborate with your team. 
                                        In demo mode, discussions are stored locally only.
                                    </p>
                                    <button id="startFirstDiscussion" class="btn btn-primary">
                                        <i class="fas fa-plus"></i>
                                        Start First Discussion (Demo)
                                    </button>
                                    
                                    <div class="implementation-guide">
                                        <div class="guide-title">Required Backend Implementation</div>
                                        <div class="guide-step">
                                            <div class="step-number">1</div>
                                            <div class="step-content">
                                                <div class="step-title">Create Thread Model</div>
                                                <div class="step-description">Database schema for threads with title, content, author, category</div>
                                            </div>
                                        </div>
                                        <div class="guide-step">
                                            <div class="step-number">2</div>
                                            <div class="step-content">
                                                <div class="step-title">Implement Comment System</div>
                                                <div class="step-description">Nested comments with threading, mentions, and notifications</div>
                                            </div>
                                        </div>
                                        <div class="guide-step">
                                            <div class="step-number">3</div>
                                            <div class="step-content">
                                                <div class="step-title">Add Real-time Updates</div>
                                                <div class="step-description">WebSocket events for new threads and comments</div>
                                            </div>
                                        </div>
                                        <div class="api-docs">
                                            <pre class="code"><span class="code-comment">// POST /api/projects/:id/threads</span>
<span class="code-keyword">Request</span>:
{
  <span class="code-string">"title"</span>: <span class="code-string">"Discussion Title"</span>,
  <span class="code-string">"content"</span>: <span class="code-string">"Discussion content..."</span>,
  <span class="code-string">"category"</span>: <span class="code-string">"clinical|technical|data|methodology|general"</span>
}

<span class="code-comment">// WebSocket Event: new_thread</span>
{
  <span class="code-string">"type"</span>: <span class="code-string">"new_thread"</span>,
  <span class="code-string">"thread"</span>: {
    <span class="code-string">"id"</span>: <span class="code-string">"thread_123"</span>,
    <span class="code-string">"title"</span>: <span class="code-string">"Discussion Title"</span>,
    <span class="code-string">"author"</span>: { <span class="code-string">"name"</span>: <span class="code-string">"Dr. Alex Chen"</span> },
    <span class="code-string">"created_at"</span>: <span class="code-string">"2024-01-15T10:30:00Z"</span>
  }
}</pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Documents tab -->
                        <div id="documentsTab" class="tab-content">
                            <div class="project-section">
                                <div class="section-header">
                                    <h2 class="section-title">Project Documents</h2>
                                    <button id="uploadDocumentBtn" class="btn btn-disabled" title="Requires file upload backend">
                                        <i class="fas fa-upload"></i>
                                        Upload (Disabled)
                                    </button>
                                </div>
                                
                                <div class="empty-state">
                                    <div class="empty-state-icon">üìÑ</div>
                                    <h3 class="empty-state-title">Document Management Not Implemented</h3>
                                    <p class="empty-state-description">
                                        File upload, storage, and sharing require backend implementation with secure file handling.
                                    </p>
                                    
                                    <div class="implementation-guide">
                                        <div class="guide-title">Required Implementation</div>
                                        <div class="guide-step">
                                            <div class="step-number">1</div>
                                            <div class="step-content">
                                                <div class="step-title">File Storage Service</div>
                                                <div class="step-description">Implement secure file upload to S3/Azure Blob/Cloud Storage</div>
                                            </div>
                                        </div>
                                        <div class="guide-step">
                                            <div class="step-number">2</div>
                                            <div class="step-content">
                                                <div class="step-title">Document Metadata Database</div>
                                                <div class="step-description">Store file metadata, permissions, and version history</div>
                                            </div>
                                        </div>
                                        <div class="guide-step">
                                            <div class="step-number">3</div>
                                            <div class="step-content">
                                                <div class="step-title">Secure Access Control</div>
                                                <div class="step-description">Implement role-based access to sensitive clinical documents</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timeline tab -->
                        <div id="timelineTab" class="tab-content">
                            <div class="project-section">
                                <div class="section-header">
                                    <h2 class="section-title">Project Timeline</h2>
                                    <div class="feature-status status-backend-required">Auto-generated</div>
                                </div>
                                
                                <div class="empty-state">
                                    <div class="empty-state-icon">üìÖ</div>
                                    <h3 class="empty-state-title">Timeline Will Be Auto-generated</h3>
                                    <p class="empty-state-description">
                                        Project timeline will automatically populate with key milestones, discussions, and document uploads once backend is implemented.
                                    </p>
                                    
                                    <div id="projectTimeline" class="timeline">
                                        <div class="timeline-empty">
                                            <div class="timeline-dot"></div>
                                            <div class="timeline-content">
                                                <div class="timeline-date">Project Created</div>
                                                <p>Project timeline events will appear here automatically</p>
                                            </div>
                                        </div>
                                        <div class="timeline-empty">
                                            <div class="timeline-dot"></div>
                                            <div class="timeline-content">
                                                <div class="timeline-date">First Discussion</div>
                                                <p>Will be added when discussions are implemented</p>
                                            </div>
                                        </div>
                                        <div class="timeline-empty">
                                            <div class="timeline-dot"></div>
                                            <div class="timeline-content">
                                                <div class="timeline-date">Team Expansion</div>
                                                <p>Will be added when team members join</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="project-sidebar">
                        <!-- Team section -->
                        <div class="project-section">
                            <div class="section-header">
                                <h2 class="section-title">Project Team</h2>
                                <button id="inviteMemberBtn" class="btn btn-disabled" title="Requires user management backend">
                                    <i class="fas fa-user-plus"></i>
                                </button>
                            </div>
                            
                            <div class="team-grid" id="teamList">
                                <div class="team-member empty">
                                    <div style="text-align: center;">
                                        <div style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.3;">üë•</div>
                                        <div style="color: var(--ui-light); font-size: 0.875rem;">
                                            No team members yet
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="implementation-guide" style="margin-top: 1rem;">
                                <div class="guide-title">Team Management Required</div>
                                <div class="guide-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <div class="step-title">User Directory</div>
                                        <div class="step-description">Implement user search and invitation system</div>
                                    </div>
                                </div>
                                <div class="guide-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <div class="step-title">Project Membership</div>
                                        <div class="step-description">Database relationships for project-team membership</div>
                                    </div>
                                </div>
                                <div class="guide-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <div class="step-title">Role Management</div>
                                        <div class="step-description">Assign roles (clinician/industry) with different permissions</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Engagement stats -->
                        <div class="project-section">
                            <div class="section-header">
                                <h2 class="section-title">Engagement Metrics</h2>
                                <div class="feature-status status-backend-required">No Data</div>
                            </div>
                            <div class="engagement-stats">
                                <div class="stat-card">
                                    <div class="stat-value empty">--</div>
                                    <div class="stat-label">Discussions</div>
                                    <div style="font-size: 0.75rem; color: var(--ui-light); margin-top: 0.25rem;">
                                        Requires backend
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value empty">--</div>
                                    <div class="stat-label">Comments</div>
                                    <div style="font-size: 0.75rem; color: var(--ui-light); margin-top: 0.25rem;">
                                        Requires backend
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value empty">--</div>
                                    <div class="stat-label">Members</div>
                                    <div style="font-size: 0.75rem; color: var(--ui-light); margin-top: 0.25rem;">
                                        Requires backend
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value empty">--</div>
                                    <div class="stat-label">Files</div>
                                    <div style="font-size: 0.75rem; color: var(--ui-light); margin-top: 0.25rem;">
                                        Requires backend
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick actions -->
                        <div class="project-section">
                            <div class="section-header">
                                <h2 class="section-title">Quick Actions</h2>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <button id="quickPollBtn" class="btn btn-disabled" title="Requires polling/voting backend">
                                    <i class="fas fa-chart-pie"></i>
                                    Create Poll (Disabled)
                                </button>
                                <button id="scheduleMeetingBtn" class="btn btn-disabled" title="Requires calendar integration">
                                    <i class="fas fa-calendar-alt"></i>
                                    Schedule Meeting (Disabled)
                                </button>
                                <button id="exportDataBtn" class="btn btn-disabled" title="Requires data export backend">
                                    <i class="fas fa-download"></i>
                                    Export Data (Disabled)
                                </button>
                                <button id="viewApiImplementation" class="btn btn-secondary">
                                    <i class="fas fa-code"></i>
                                    View Implementation Guide
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Modals -->
    
    <!-- New Discussion Modal -->
    <div id="newThreadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Start New Discussion (Demo)</h2>
                <button class="close-modal" data-modal="newThreadModal">&times;</button>
            </div>
            <form id="newThreadForm">
                <div class="warning-banner">
                    <div class="warning-icon">
                        <i class="fas fa-flask"></i>
                    </div>
                    <div class="warning-content">
                        <div class="warning-title">Demo Mode Active</div>
                        <div class="warning-description">
                            This discussion will be stored locally only. To enable persistent discussions, implement the backend API.
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="threadTitle" class="form-label">Title</label>
                    <input type="text" id="threadTitle" class="form-input" required 
                           placeholder="e.g., Dataset quality issues in Phase 2">
                </div>
                
                <div class="form-group">
                    <label for="threadCategory" class="form-label">Category</label>
                    <select id="threadCategory" class="form-input form-select" required>
                        <option value="">Select category</option>
                        <option value="clinical">Clinical Observation</option>
                        <option value="technical">Technical Question</option>
                        <option value="data">Data Analysis</option>
                        <option value="methodology">Methodology</option>
                        <option value="general">General Discussion</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="threadContent" class="form-label">Content</label>
                    <textarea id="threadContent" class="form-textarea" required 
                              placeholder="Describe your question or observation..."
                              rows="6"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="newThreadModal">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitThreadBtn">
                        Create Demo Discussion
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- API Implementation Guide Modal -->
    <div id="apiGuideModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Backend Implementation Guide</h2>
                <button class="close-modal" data-modal="apiGuideModal">&times;</button>
            </div>
            
            <div class="implementation-guide">
                <div class="guide-title">Core API Endpoints Required</div>
                
                <div class="guide-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Project Management</div>
                        <div class="step-description">
                            <div class="api-docs">
                                <pre class="code"><span class="code-comment">// GET /api/projects/:id</span>
<span class="code-keyword">Response</span>:
{
  <span class="code-string">"success"</span>: <span class="code-keyword">true</span>,
  <span class="code-string">"project"</span>: {
    <span class="code-string">"id"</span>: <span class="code-string">"proj_123"</span>,
    <span class="code-string">"title"</span>: <span class="code-string">"Project Title"</span>,
    <span class="code-string">"description"</span>: <span class="code-string">"Full description..."</span>,
    <span class="code-string">"type"</span>: <span class="code-string">"collaborative"</span>,
    <span class="code-string">"status"</span>: <span class="code-string">"active"</span>,
    <span class="code-string">"created_at"</span>: <span class="code-string">"2024-01-15T10:30:00Z"</span>,
    <span class="code-string">"creator"</span>: {
      <span class="code-string">"id"</span>: <span class="code-string">"user_123"</span>,
      <span class="code-string">"name"</span>: <span class="code-string">"Dr. Alex Chen"</span>,
      <span class="code-string">"role"</span>: <span class="code-string">"clinician"</span>
    },
    <span class="code-string">"team"</span>: [
      {
        <span class="code-string">"id"</span>: <span class="code-string">"user_123"</span>,
        <span class="code-string">"name"</span>: <span class="code-string">"Dr. Alex Chen"</span>,
        <span class="code-string">"role"</span>: <span class="code-string">"clinician"</span>,
        <span class="code-string">"specialty"</span>: <span class="code-string">"Pulmonology"</span>,
        <span class="code-string">"joined_at"</span>: <span class="code-string">"2024-01-15T10:30:00Z"</span>
      }
    ],
    <span class="code-string">"metrics"</span>: {
      <span class="code-string">"threads"</span>: <span class="code-number">0</span>,
      <span class="code-string">"comments"</span>: <span class="code-number">0</span>,
      <span class="code-string">"members"</span>: <span class="code-number">1</span>,
      <span class="code-string">"files"</span>: <span class="code-number">0</span>
    }
  }
}</pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="guide-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Discussion System</div>
                        <div class="step-description">
                            <div class="api-docs">
                                <pre class="code"><span class="code-comment">// POST /api/projects/:id/threads</span>
<span class="code-keyword">Request</span>:
{
  <span class="code-string">"title"</span>: <span class="code-string">"Discussion Title"</span>,
  <span class="code-string">"content"</span>: <span class="code-string">"Discussion content..."</span>,
  <span class="code-string">"category"</span>: <span class="code-string">"clinical"</span>
}

<span class="code-comment">// GET /api/projects/:id/threads</span>
<span class="code-keyword">Response</span>:
{
  <span class="code-string">"success"</span>: <span class="code-keyword">true</span>,
  <span class="code-string">"threads"</span>: [
    {
      <span class="code-string">"id"</span>: <span class="code-string">"thread_123"</span>,
      <span class="code-string">"title"</span>: <span class="code-string">"Discussion Title"</span>,
      <span class="code-string">"content"</span>: <span class="code-string">"Discussion content..."</span>,
      <span class="code-string">"category"</span>: <span class="code-string">"clinical"</span>,
      <span class="code-string">"author"</span>: {
        <span class="code-string">"id"</span>: <span class="code-string">"user_123"</span>,
        <span class="code-string">"name"</span>: <span class="code-string">"Dr. Alex Chen"</span>,
        <span class="code-string">"role"</span>: <span class="code-string">"clinician"</span>
      },
      <span class="code-string">"created_at"</span>: <span class="code-string">"2024-01-15T10:30:00Z"</span>,
      <span class="code-string">"comment_count"</span>: <span class="code-number">0</span>,
      <span class="code-string">"upvotes"</span>: <span class="code-number">0</span>,
      <span class="code-string">"expert_endorsed"</span>: <span class="code-keyword">false</span>
    }
  ]
}</pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="guide-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">WebSocket Events</div>
                        <div class="step-description">
                            <div class="api-docs">
                                <pre class="code"><span class="code-comment">// Connect to WebSocket</span>
<span class="code-function">const</span> ws = <span class="code-keyword">new</span> WebSocket(<span class="code-string">'wss://your-domain.com/project/:id'</span>);

<span class="code-comment">// Authentication message</span>
ws.<span class="code-function">send</span>(<span class="code-function">JSON</span>.<span class="code-function">stringify</span>({
  <span class="code-string">"type"</span>: <span class="code-string">"authenticate"</span>,
  <span class="code-string">"token"</span>: <span class="code-string">"jwt_token_here"</span>,
  <span class="code-string">"project_id"</span>: <span class="code-string">"project_id_here"</span>
}));

<span class="code-comment">// Event types to handle:</span>
{
  <span class="code-string">"type"</span>: <span class="code-string">"new_thread"</span>,      <span class="code-comment">// New discussion started</span>
  <span class="code-string">"type"</span>: <span class="code-string">"new_comment"</span>,     <span class="code-comment">// New comment posted</span>
  <span class="code-string">"type"</span>: <span class="code-string">"thread_updated"</span>,  <span class="code-comment">// Thread modified</span>
  <span class="code-string">"type"</span>: <span class="code-string">"project_updated"</span>, <span class="code-comment">// Project details changed</span>
  <span class="code-string">"type"</span>: <span class="code-string">"member_joined"</span>,   <span class="code-comment">// New team member</span>
  <span class="code-string">"type"</span>: <span class="code-string">"document_uploaded"</span> <span class="code-comment">// New file uploaded</span>
}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-primary" data-modal="apiGuideModal">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <script>
        class ProjectView {
            constructor() {
                this.projectId = this.getProjectIdFromURL();
                this.token = localStorage.getItem('thoraxlab_token');
                this.user = JSON.parse(localStorage.getItem('thoraxlab_user') || 'null');
                this.ws = null;
                this.localThreads = JSON.parse(localStorage.getItem(`thoraxlab_threads_${this.projectId}`) || '[]');
                this.initialize();
            }
            
            initialize() {
                this.setupEventListeners();
                this.checkAuth();
            }
            
            getProjectIdFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('id') || 'demo-project';
            }
            
            checkAuth() {
                // Always show in demo mode
                this.loadProject();
                this.updateUserDisplay();
            }
            
            updateUserDisplay() {
                if (this.user) {
                    document.getElementById('userDisplayName').textContent = this.user.name;
                    document.getElementById('userDisplayRole').textContent = 
                        this.user.role === 'clinician' ? 'Clinical Professional' : 'Industry Professional';
                    document.getElementById('userAvatar').textContent = 
                        this.user.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                }
            }
            
            async loadProject() {
                try {
                    // Try to load from localStorage first (demo mode)
                    const localProjects = JSON.parse(localStorage.getItem('thoraxlab_projects') || '[]');
                    const project = localProjects.find(p => p.id === this.projectId);
                    
                    if (project) {
                        this.renderProject(project);
                    } else {
                        // Create a demo project if none exists
                        const demoProject = {
                            id: this.projectId,
                            title: 'Demo Collaboration Project',
                            description: 'This is a demonstration project showing the ThoraxLab collaboration interface. In a real implementation, this would be a clinical-industry collaboration project with real data and team members.',
                            type: 'collaborative',
                            status: 'active',
                            created_at: new Date().toISOString(),
                            creator_id: this.user?.id || 'demo-user',
                            creator_name: this.user?.name || 'Demo User',
                            metrics: {
                                threads: this.localThreads.length,
                                comments: 0,
                                members: 1,
                                files: 0
                            }
                        };
                        
                        this.renderProject(demoProject);
                    }
                    
                } catch (error) {
                    console.error('Project load error:', error);
                    this.showError('Failed to load project');
                }
            }
            
            renderProject(project) {
                // Hide loading, show content
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('projectContent').classList.remove('hidden');
                
                // Update project details
                document.getElementById('projectTitle').textContent = project.title;
                document.getElementById('projectDescription').innerHTML = this.formatDescription(project.description);
                
                // Update metadata
                const createdDate = new Date(project.created_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                document.getElementById('projectCreated').textContent = `Created ${createdDate}`;
                document.getElementById('projectType').textContent = project.type === 'collaborative' ? 'Joint Collaboration' : 
                                                                   project.type === 'clinical' ? 'Clinical-Led Research' : 'Industry-Led Development';
                
                // Update engagement stats
                if (project.metrics) {
                    const threadsElement = document.querySelectorAll('.stat-value')[0];
                    const commentsElement = document.querySelectorAll('.stat-value')[1];
                    const membersElement = document.querySelectorAll('.stat-value')[2];
                    const filesElement = document.querySelectorAll('.stat-value')[3];
                    
                    threadsElement.textContent = project.metrics.threads || 0;
                    threadsElement.className = project.metrics.threads > 0 ? 'stat-value' : 'stat-value empty';
                    
                    commentsElement.textContent = project.metrics.comments || 0;
                    commentsElement.className = project.metrics.comments > 0 ? 'stat-value' : 'stat-value empty';
                    
                    membersElement.textContent = project.metrics.members || 1;
                    membersElement.className = project.metrics.members > 0 ? 'stat-value' : 'stat-value empty';
                    
                    filesElement.textContent = project.metrics.files || 0;
                    filesElement.className = project.metrics.files > 0 ? 'stat-value' : 'stat-value empty';
                }
                
                // Load threads if any
                if (this.localThreads.length > 0) {
                    this.renderThreads(this.localThreads);
                }
            }
            
            formatDescription(text) {
                if (!text) return '';
                // Convert line breaks to paragraphs
                return text.split('\n').filter(p => p.trim()).map(p => `<p>${this.escapeHtml(p)}</p>`).join('');
            }
            
            showError(message) {
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
                
                const errorTitle = document.querySelector('#errorState h3');
                if (errorTitle && message) {
                    errorTitle.textContent = message;
                }
            }
            
            setupEventListeners() {
                // Tab navigation
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.target.getAttribute('data-tab');
                        this.switchTab(tabId);
                    });
                });
                
                // New thread buttons
                document.getElementById('newThreadBtn').addEventListener('click', () => {
                    this.showModal('newThreadModal');
                });
                
                document.getElementById('startDiscussionBtn').addEventListener('click', () => {
                    this.showModal('newThreadModal');
                });
                
                document.addEventListener('click', (e) => {
                    if (e.target && e.target.id === 'startFirstDiscussion') {
                        this.showModal('newThreadModal');
                    }
                });
                
                // Edit project button (disabled)
                document.getElementById('editProjectBtn').addEventListener('click', () => {
                    this.showToast('Project editing requires backend implementation', 'warning');
                });
                
                // Form submissions
                document.getElementById('newThreadForm').addEventListener('submit', (e) => this.createThread(e));
                
                // Modal close buttons
                document.querySelectorAll('.close-modal').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const modalId = e.target.getAttribute('data-modal');
                        this.hideModal(modalId);
                    });
                });
                
                document.querySelectorAll('[data-modal]').forEach(button => {
                    if (button.type === 'button') {
                        button.addEventListener('click', (e) => {
                            const modalId = e.target.getAttribute('data-modal');
                            this.hideModal(modalId);
                        });
                    }
                });
                
                // Quick actions (all disabled)
                document.getElementById('quickPollBtn').addEventListener('click', () => {
                    this.showToast('Poll feature requires voting backend implementation', 'info');
                });
                
                document.getElementById('scheduleMeetingBtn').addEventListener('click', () => {
                    this.showToast('Meeting scheduling requires calendar integration', 'info');
                });
                
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.showToast('Data export requires backend implementation', 'info');
                });
                
                document.getElementById('inviteMemberBtn').addEventListener('click', () => {
                    this.showToast('Team invitation requires user management backend', 'info');
                });
                
                document.getElementById('uploadDocumentBtn').addEventListener('click', () => {
                    this.showToast('File upload requires secure file storage backend', 'info');
                });
                
                // View API guide
                document.getElementById('viewApiImplementation').addEventListener('click', () => {
                    this.showModal('apiGuideModal');
                });
                
                // View all activity
                document.addEventListener('click', (e) => {
                    if (e.target && e.target.closest('#viewAllActivity')) {
                        this.switchTab('discussions');
                    }
                });
            }
            
            switchTab(tabId) {
                // Update active tab
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                });
                
                // Update active content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === `${tabId}Tab`);
                });
                
                // Load tab content if needed
                if (tabId === 'discussions') {
                    this.loadThreads();
                }
            }
            
            async loadThreads() {
                const container = document.getElementById('discussionsList');
                
                if (this.localThreads.length === 0) {
                    // Show empty state
                    container.innerHTML = `
                        <div class="empty-state" style="padding: 2rem;">
                            <div class="empty-state-icon">üí¨</div>
                            <h3 class="empty-state-title">No Discussions Yet</h3>
                            <p class="empty-state-description">
                                Start the first discussion to collaborate with your team. 
                                In demo mode, discussions are stored locally only.
                            </p>
                            <button id="startFirstDiscussion" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Start First Discussion (Demo)
                            </button>
                        </div>
                    `;
                } else {
                    this.renderThreads(this.localThreads);
                }
            }
            
            renderThreads(threads) {
                const container = document.getElementById('discussionsList');
                if (!container || !threads) return;
                
                container.innerHTML = threads.map(thread => `
                    <div class="thread-preview" data-thread-id="${thread.id}">
                        <div class="thread-header">
                            <h3 class="thread-title">${this.escapeHtml(thread.title)}</h3>
                            <span class="thread-meta">
                                ${new Date(thread.created_at).toLocaleDateString()}
                            </span>
                        </div>
                        <p class="thread-excerpt">
                            ${this.escapeHtml(thread.content.substring(0, 150))}${thread.content.length > 150 ? '...' : ''}
                        </p>
                        <div class="thread-engagement">
                            <span class="engagement-item">
                                <i class="fas fa-comment"></i> ${thread.comment_count || 0}
                            </span>
                            <span class="engagement-item">
                                <i class="fas fa-heart" style="color: #EF4444;"></i> ${thread.upvotes || 0}
                            </span>
                            <span class="engagement-item">
                                <i class="fas fa-flask" style="color: var(--ui-warning);"></i> Demo
                            </span>
                        </div>
                    </div>
                `).join('');
                
                // Add click listeners to thread previews
                document.querySelectorAll('.thread-preview:not(.empty)').forEach(preview => {
                    preview.addEventListener('click', (e) => {
                        if (!e.target.closest('button')) {
                            const threadId = preview.getAttribute('data-thread-id');
                            this.showToast('Thread detail view requires backend implementation', 'info');
                        }
                    });
                });
            }
            
            async createThread(e) {
                e.preventDefault();
                
                const submitBtn = document.getElementById('submitThreadBtn');
                const originalText = submitBtn.textContent;
                
                submitBtn.disabled = true;
                submitBtn.textContent = 'Creating...';
                
                try {
                    // Create demo thread
                    const threadData = {
                        id: 'thread_' + Date.now(),
                        title: document.getElementById('threadTitle').value,
                        content: document.getElementById('threadContent').value,
                        category: document.getElementById('threadCategory').value,
                        created_at: new Date().toISOString(),
                        author: {
                            id: this.user?.id || 'demo-user',
                            name: this.user?.name || 'Demo User',
                            role: this.user?.role || 'clinician'
                        },
                        comment_count: 0,
                        upvotes: 0,
                        expert_endorsed: false
                    };
                    
                    // Save locally
                    this.localThreads.unshift(threadData);
                    localStorage.setItem(`thoraxlab_threads_${this.projectId}`, JSON.stringify(this.localThreads));
                    
                    // Update metrics
                    const threadsElement = document.querySelectorAll('.stat-value')[0];
                    const currentCount = parseInt(threadsElement.textContent) || 0;
                    threadsElement.textContent = currentCount + 1;
                    threadsElement.className = 'stat-value';
                    
                    this.hideModal('newThreadModal');
                    document.getElementById('newThreadForm').reset();
                    
                    // Refresh threads if on that tab
                    if (document.getElementById('discussionsTab').classList.contains('active')) {
                        this.loadThreads();
                    }
                    
                    this.showToast('Demo discussion created (stored locally)', 'success');
                    
                } catch (error) {
                    console.error('Create thread error:', error);
                    this.showToast('Error creating discussion', 'error');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            }
            
            showModal(modalId) {
                document.getElementById(modalId).style.display = 'flex';
            }
            
            hideModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }
            
            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                if (!container) return;
                
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                
                const icon = type === 'success' ? 'fa-check-circle' : 
                           type === 'error' ? 'fa-exclamation-circle' : 
                           type === 'warning' ? 'fa-exclamation-triangle' : 
                           'fa-info-circle';
                
                toast.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <span>${this.escapeHtml(message)}</span>
                `;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'toastSlideIn 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                }, 4000);
            }
            
            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }
        
        // Initialize the project view
        window.addEventListener('DOMContentLoaded', () => {
            window.projectView = new ProjectView();
        });
    </script>
</body>
</html>
